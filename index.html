<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <link rel="icon" href="./favicon.ico" type="image/x-icon">
  <title>–ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä –∑–∞–∫–∞–∑–∞ BK</title>
  <link rel="stylesheet" href="./style.css" />
</head>

<body>

<!-- ===== –í–•–û–î ===== -->
<div id="loginOverlay" class="login-overlay">
  <div class="login-box">
    <span style="font-size:42px;display:block;margin-bottom:2px;"> <img src="./icons/burger.png" width="28" height="28" alt=""></span>
    <h2>–ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä –∑–∞–∫–∞–∑–∞</h2>
    <p>–í–≤–µ–¥–∏—Ç–µ –ø–∞—Ä–æ–ª—å –¥–ª—è –≤—Ö–æ–¥–∞</p>
    <input id="loginPassword" type="password" placeholder="–ü–∞—Ä–æ–ª—å" autocomplete="current-password" />
    <button id="loginBtn" class="btn primary">–í–æ–π—Ç–∏</button>
  </div>
</div>

<header class="header">
<h1 align="center">
  <img
    src="./icons/burger.png"
    width="28"
    height="28"
    style="vertical-align: -4px;"
    alt=""
  >
  –ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä –∑–∞–∫–∞–∑–∞
</h1>
  <nav class="header-menu">
    <button id="menuHistory" class="menu-btn"><img src="./icons/history.png" width="14" height="14"   align="middle" alt="">
 –ò—Å—Ç–æ—Ä–∏—è –∑–∞–∫–∞–∑–æ–≤</button>
    <button id="menuDatabase" class="menu-btn"><img src="./icons/base.png" width="14" height="14"  align="middle" alt="">
 –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö</button>
  </nav>
  <span id="entityBadge" class="entity-badge">–ë—É—Ä–≥–µ—Ä –ë–ö</span>
</header>

<main class="container">

  <!-- ===== –ü–ê–†–ê–ú–ï–¢–†–´ –ó–ê–ö–ê–ó–ê ===== -->
  <section class="card">
    <h2>–ü–∞—Ä–∞–º–µ—Ç—Ä—ã –∑–∞–∫–∞–∑–∞</h2>

    <div class="settings">
      <label>
        –Æ—Ä. –ª–∏—Ü–æ
        <select id="legalEntity">
          <option value="–ë—É—Ä–≥–µ—Ä –ë–ö">–ë—É—Ä–≥–µ—Ä –ë–ö</option>
          <option value="–í–æ–≥–ª–∏—è –ú–∞—Ç—Ç–∞">–í–æ–≥–ª–∏—è –ú–∞—Ç—Ç–∞</option>
          <option value="–ü–∏—Ü—Ü–∞ –°—Ç–∞—Ä">–ü–∏—Ü—Ü–∞ –°—Ç–∞—Ä</option>
        </select>
      </label>

      <label>
        –ü–æ—Å—Ç–∞–≤—â–∏–∫
        <select id="supplierFilter">
          <option value="">–í—Å–µ / —Å–≤–æ–±–æ–¥–Ω—ã–π</option>
        </select>
      </label>

      <label>
        –î–∞—Ç–∞ —Å–µ–≥–æ–¥–Ω—è
        <input type="date" id="today" />
      </label>

      <label>
        –î–∞—Ç–∞ –ø—Ä–∏—Ö–æ–¥–∞
        <input type="date" id="deliveryDate" />
      </label>

      <label>
        –ü–µ—Ä–∏–æ–¥ —Ä–∞—Å—Ö–æ–¥–∞ (–¥–Ω–µ–π)
        <input type="number" id="periodDays" value="30" />
      </label>


      <label>
        –¢–æ–≤–∞—Ä–Ω—ã–π –∑–∞–ø–∞—Å
        <div style="display:flex;gap:4px;">
          <input type="text" id="safetyDays" placeholder="14 / –¥–æ 18.02.26" style="flex:1;" />
          <button type="button" id="safetyCalendarBtn" class="btn secondary" title="–í—ã–±—Ä–∞—Ç—å –¥–∞—Ç—É" style="padding:6px 10px;font-size:16px;">üìÖ</button>
        </div>
      </label>
      <label>
        –ï–¥–∏–Ω–∏—Ü—ã
        <select id="unit">
          <option value="pieces">–®—Ç—É–∫–∏</option>
          <option value="boxes">–ö–æ—Ä–æ–±–∫–∏</option>
        </select>
      </label>

      <label>
        –ù–∞–ª–∏—á–∏–µ —Ç—Ä–∞–Ω–∑–∏—Ç–∞
        <select id="hasTransit">
          <option value="false">–ù–µ—Ç</option>
          <option value="true">–î–∞</option>
        </select>
      </label>

      <label>
        –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∑–∞–ø–∞—Å–∞
        <select id="showStockColumn">
          <option value="false">–ù–µ—Ç</option>
          <option value="true">–î–∞</option>
        </select>
      </label>
    </div>

    <!-- –ö–õ–Æ–ß–ï–í–ê–Ø –ö–ù–û–ü–ö–ê -->
    <button id="buildOrder" class="btn primary">
      üì¶ –°—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞—Ç—å –∑–∞–∫–∞–∑
    </button>
  </section>

  <!-- ===== –ó–ê–ö–ê–ó (–°–ö–†–´–¢ –î–û –ö–ù–û–ü–ö–ò) ===== -->
  <div id="orderSection" class="hidden">

    <!-- –î–û–ë–ê–í–õ–ï–ù–ò–ï –¢–û–í–ê–†–û–í -->
    <section class="card">
      <h2>–î–æ–±–∞–≤–ª–µ–Ω–∏–µ —Ç–æ–≤–∞—Ä–æ–≤</h2>

      <div class="actions">
        <button id="addManual" class="btn primary">‚úçÔ∏è –†—É—á–Ω–æ–π —Ç–æ–≤–∞—Ä</button>
        <button id="copyOrder" class="btn secondary">üìã –°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å –∑–∞–∫–∞–∑</button>
        <button id="saveOrder" class="btn primary">üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∑–∞–∫–∞–∑</button>
      </div>

      <section class="search">
        <input
          id="productSearch"
          placeholder="üîç –ü–æ–∏—Å–∫ –ø–æ –∞—Ä—Ç–∏–∫—É–ª—É –∏–ª–∏ –Ω–∞–∑–≤–∞–Ω–∏—é"
        />
        <button id="clearSearch" class="search-clear hidden" title="–û—á–∏—Å—Ç–∏—Ç—å –ø–æ–∏—Å–∫">‚úñ</button>
        <div id="searchResults" class="search-results"></div>
      </section>
    </section>

    <!-- –¢–ê–ë–õ–ò–¶–ê –ó–ê–ö–ê–ó–ê -->
    <section class="card">
      <h2>–ó–∞–∫–∞–∑</h2>

      <!-- –ö–û–ú–ü–ê–ö–¢–ù–û–ï –ú–ï–ù–Æ -->
      <div class="order-actions" style="display:flex;gap:6px;margin-bottom:12px;font-size:13px;">
        <button id="undoBtn" class="btn secondary" disabled title="–û—Ç–º–µ–Ω–∏—Ç—å (Ctrl+Z)" style="padding:4px 8px;">‚Ü∂</button>
        <button id="redoBtn" class="btn secondary" disabled title="–ü–æ–≤—Ç–æ—Ä–∏—Ç—å (Ctrl+Y)" style="padding:4px 8px;">‚Ü∑</button>
        <button id="allToOrderBtn" class="btn primary" title="–ü–µ—Ä–µ–Ω–µ—Å—Ç–∏ —Ä–∞—Å—á—ë—Ç –≤ –∑–∞–∫–∞–∑ –¥–ª—è –≤—Å–µ—Ö —Ç–æ–≤–∞—Ä–æ–≤" style="padding:4px 10px;">–í –∑–∞–∫–∞–∑ –≤—Å—ë</button>
        <button id="clearOrder" class="btn secondary" style="padding:4px 10px;">–û—á–∏—Å—Ç–∏—Ç—å</button>
      </div>

      <div class="table-wrap">
        <table>
          <thead>
            <tr>
              <th style="width:30px;"></th>
              <th>–¢–æ–≤–∞—Ä</th>
              <th>–†–∞—Å—Ö–æ–¥</th>
              <th>–û—Å—Ç–∞—Ç–æ–∫</th>
              <th class="transit-col">–¢—Ä–∞–Ω–∑–∏—Ç</th>
              <th class="stock-col">–ó–∞–ø–∞—Å</th>
              <th>–†–∞—Å—á—ë—Ç</th>
              <th>–ó–∞–∫–∞–∑ (—à—Ç / –∫–æ—Ä)</th>
              <th>–•–≤–∞—Ç–∏—Ç –¥–æ</th>
              <th>–ü–∞–ª–ª–µ—Ç—ã</th>
              <th style="width:40px;"></th>
            </tr>
          </thead>
          <tbody id="items"></tbody>
        </table>
      </div>
    </section>

    <!-- –ò–¢–û–ì -->
    <section class="card">
      <h2>–ò—Ç–æ–≥ –∑–∞–∫–∞–∑–∞</h2>
      <div id="finalSummary"></div>
    </section>

  </div>


</main>

<!-- ===== –ú–û–î–ê–õ–ö–ê: –ò–°–¢–û–†–ò–Ø –ó–ê–ö–ê–ó–û–í ===== -->
<div id="historyModal" class="modal hidden">
  <div class="modal-box large">
    <div class="modal-header">
      <h2>–ò—Å—Ç–æ—Ä–∏—è –∑–∞–∫–∞–∑–æ–≤</h2>
      <button id="closeHistory" class="modal-close">‚úñ</button>
    </div>

    <label>
      –ü–æ—Å—Ç–∞–≤—â–∏–∫
      <select id="historySupplier">
        <option value="">–í—Å–µ</option>
      </select>
    </label>

    <div id="orderHistory"></div>
  </div>
</div>


<!-- ===== –ú–û–î–ê–õ–ö–ê: –†–£–ß–ù–û–ô –¢–û–í–ê–† ===== -->
<div id="manualModal" class="modal hidden">
  <div class="modal-box">
    <div class="modal-header">
      <h2>–†—É—á–Ω–æ–π —Ç–æ–≤–∞—Ä</h2>
      <button id="closeManual" class="modal-close">‚úñ</button>
    </div>

    <input id="m_name" placeholder="–ù–∞–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ*" />
    <input id="m_sku" placeholder="–ê—Ä—Ç–∏–∫—É–ª" />
    <input id="m_supplier" placeholder="–ü–æ—Å—Ç–∞–≤—â–∏–∫" />
    
    <label>
      –Æ—Ä. –ª–∏—Ü–æ
      <select id="m_legalEntity">
        <option value="–ë—É—Ä–≥–µ—Ä –ë–ö">–ë—É—Ä–≥–µ—Ä –ë–ö</option>
        <option value="–í–æ–≥–ª–∏—è –ú–∞—Ç—Ç–∞">–í–æ–≥–ª–∏—è –ú–∞—Ç—Ç–∞</option>
        <option value="–ü–∏—Ü—Ü–∞ –°—Ç–∞—Ä">–ü–∏—Ü—Ü–∞ –°—Ç–∞—Ä</option>
      </select>
    </label>
    
    <input id="m_box" type="number" placeholder="–®—Ç—É–∫ –≤ –∫–æ—Ä–æ–±–∫–µ" />
    <input id="m_pallet" type="number" placeholder="–ö–æ—Ä–æ–±–æ–≤ –Ω–∞ –ø–∞–ª–ª–µ—Ç–µ" />
    
    <label>
      –ï–¥–∏–Ω–∏—Ü–∞ –∏–∑–º–µ—Ä–µ–Ω–∏—è
      <select id="m_unit">
        <option value="—à—Ç">—à—Ç—É–∫–∏</option>
        <option value="–ª">–ª–∏—Ç—Ä—ã</option>
        <option value="–∫–≥">–∫–∏–ª–æ–≥—Ä–∞–º–º—ã</option>
      </select>
    </label>

    <label>
      <input type="checkbox" id="m_save" />
      –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –≤ –±–∞–∑—É
    </label>

    <div class="actions">
      <button id="m_add" class="btn primary">–î–æ–±–∞–≤–∏—Ç—å</button>
      <button id="m_cancel" class="btn secondary">–û—Ç–º–µ–Ω–∞</button>
    </div>
  </div>
</div>

<!-- ===== –ú–û–î–ê–õ–ö–ê: –ü–û–î–¢–í–ï–†–ñ–î–ï–ù–ò–ï ===== -->
<div id="confirmModal" class="modal hidden">
  <div class="modal-box" style="max-width:400px;">
    <div class="modal-header">
      <h2 id="confirmTitle">–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ</h2>
      <button id="closeConfirm" class="modal-close">‚úñ</button>
    </div>
    
    <p id="confirmMessage" style="margin:0 0 24px;color:#5A2D0C;line-height:1.6;"></p>
    
    <div class="actions">
      <button id="confirmYes" class="btn primary">–î–∞</button>
      <button id="confirmNo" class="btn secondary">–û—Ç–º–µ–Ω–∞</button>
    </div>
  </div>
</div>



<!-- ===== –ú–û–î–ê–õ–ö–ê: –ë–ê–ó–ê –î–ê–ù–ù–´–• ===== -->
<div id="databaseModal" class="modal hidden">
  <div class="modal-box large">
    <div class="modal-header">
      <h2>üóÑÔ∏è –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö</h2>
      <button id="closeDatabase" class="modal-close">‚úñ</button>
    </div>

    <label>
      –Æ—Ä. –ª–∏—Ü–æ
      <select id="dbLegalEntity">
        <option value="–ë—É—Ä–≥–µ—Ä –ë–ö">–ë—É—Ä–≥–µ—Ä –ë–ö</option>
        <option value="–í–æ–≥–ª–∏—è –ú–∞—Ç—Ç–∞">–í–æ–≥–ª–∏—è –ú–∞—Ç—Ç–∞</option>
        <option value="–ü–∏—Ü—Ü–∞ –°—Ç–∞—Ä">–ü–∏—Ü—Ü–∞ –°—Ç–∞—Ä</option>
      </select>
    </label>

    <section class="search" style="margin:16px 0;">
      <input id="dbSearch" placeholder="üîç –ü–æ–∏—Å–∫ –ø–æ –∫–∞—Ä—Ç–æ—á–∫–∞–º" />
      <button id="clearDbSearch" class="search-clear hidden" title="–û—á–∏—Å—Ç–∏—Ç—å">‚úñ</button>
    </section>

    <div id="databaseList" style="max-height:60vh;overflow-y:auto;"></div>
  </div>
</div>

<!-- ===== –ú–û–î–ê–õ–ö–ê: –†–ï–î–ê–ö–¢–ò–†–û–í–ê–ù–ò–ï –ö–ê–†–¢–û–ß–ö–ò ===== -->
<div id="editCardModal" class="modal hidden">
  <div class="modal-box">
    <div class="modal-header">
      <h2>‚úèÔ∏è –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–∞—Ä—Ç–æ—á–∫–∏</h2>
      <button id="closeEditCard" class="modal-close">‚úñ</button>
    </div>

    <input id="e_name" placeholder="–ù–∞–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ*" />
    <input id="e_sku" placeholder="–ê—Ä—Ç–∏–∫—É–ª" />
    <input id="e_supplier" placeholder="–ü–æ—Å—Ç–∞–≤—â–∏–∫" />
    
    <label>
      –Æ—Ä. –ª–∏—Ü–æ
      <select id="e_legalEntity">
        <option value="–ë—É—Ä–≥–µ—Ä –ë–ö">–ë—É—Ä–≥–µ—Ä –ë–ö</option>
        <option value="–í–æ–≥–ª–∏—è –ú–∞—Ç—Ç–∞">–í–æ–≥–ª–∏—è –ú–∞—Ç—Ç–∞</option>
        <option value="–ü–∏—Ü—Ü–∞ –°—Ç–∞—Ä">–ü–∏—Ü—Ü–∞ –°—Ç–∞—Ä</option>
      </select>
    </label>
    
    <input id="e_box" type="number" placeholder="–®—Ç—É–∫ –≤ –∫–æ—Ä–æ–±–∫–µ" />
    <input id="e_pallet" type="number" placeholder="–ö–æ—Ä–æ–±–æ–∫ –Ω–∞ –ø–∞–ª–ª–µ—Ç–µ" />
    
    <label>
      –ï–¥–∏–Ω–∏—Ü–∞ –∏–∑–º–µ—Ä–µ–Ω–∏—è
      <select id="e_unit">
        <option value="—à—Ç">—à—Ç—É–∫–∏</option>
        <option value="–ª">–ª–∏—Ç—Ä—ã</option>
        <option value="–∫–≥">–∫–∏–ª–æ–≥—Ä–∞–º–º—ã</option>
      </select>
    </label>

    <div class="actions" style="margin-bottom:0;">
      <button id="e_save" class="btn primary">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
      <button id="e_cancel" class="btn secondary">–û—Ç–º–µ–Ω–∞</button>
    </div>
  </div>
</div>



<!-- ===== –ú–û–î–ê–õ–ö–ê: –°–û–•–†–ê–ù–ï–ù–ò–ï –ó–ê–ö–ê–ó–ê ===== -->
<div id="saveOrderModal" class="modal hidden">
  <div class="modal-box" style="max-width:500px;">
    <div class="modal-header">
      <h2>üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∑–∞–∫–∞–∑</h2>
      <button id="closeSaveOrder" class="modal-close">‚úñ</button>
    </div>
    
    <p style="margin:0 0 16px;color:#5A2D0C;">–î–æ–±–∞–≤—å—Ç–µ –ø—Ä–∏–º–µ—á–∞–Ω–∏–µ –∫ –∑–∞–∫–∞–∑—É (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ):</p>
    
    <textarea 
      id="orderNote" 
      placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –°—Ä–æ—á–Ω—ã–π –∑–∞–∫–∞–∑, –ü—Ä–æ–±–Ω–∞—è –ø–∞—Ä—Ç–∏—è, –∏ —Ç.–¥." 
      style="width:100%;min-height:80px;padding:10px;border:1px solid #E5BE9E;border-radius:4px;font-family:inherit;font-size:14px;resize:vertical;margin-bottom:20px;"
    ></textarea>
    
    <div class="actions" style="margin:0;">
      <button id="confirmSaveOrder" class="btn primary">üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
      <button id="cancelSaveOrder" class="btn secondary">–û—Ç–º–µ–Ω–∞</button>
    </div>
  </div>
</div>
<footer class="footer">
  <span class="version">–í–µ—Ä—Å–∏—è: <span id="appVersion">1.0.3</span></span>
</footer>

<!-- ===== –ü–†–û–í–ï–†–ö–ê –ê–í–¢–û–†–ò–ó–ê–¶–ò–ò ===== -->
<script>
// –ü—Ä–æ–≤–µ—Ä–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ –î–û –∑–∞–≥—Ä—É–∑–∫–∏ –æ—Å–Ω–æ–≤–Ω–æ–≥–æ —Å–∫—Ä–∏–ø—Ç–∞
(function() {
  if (localStorage.getItem('bk_logged_in') === 'true') {
    document.getElementById('loginOverlay').style.display = 'none';
  }
})();
</script>

<script type="module" src="./ui.js"></script>

</body>
</html>